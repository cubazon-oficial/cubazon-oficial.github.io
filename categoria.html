<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargando categoría · CUBAZON</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
    
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f0f2f5;
            color: #0f1111;
            line-height: 1.5;
        }

        a {
            text-decoration: none;
            color: #007185;
        }

        a:hover {
            color: #c7511f;
        }

        /* ===== HEADER ===== */
        #header-wrap {
            background: #131921;
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-header {
            padding: 10px 20px;
        }

        .container.row {
            max-width: 1500px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-logo img {
            height: 50px;
            width: auto;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .top-bar-social ul {
            display: flex;
            gap: 15px;
            list-style: none;
        }

        .top-bar-social ul li a {
            color: white;
            font-size: 18px;
        }

        .right-menu ul {
            display: flex;
            gap: 20px;
            list-style: none;
        }

        .right-menu ul li a {
            color: white;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: color 0.3s;
        }

        .right-menu ul li a:hover {
            color: #f08804;
        }

        .sora-cart {
            position: relative;
        }

        .sora-cart-details {
            display: flex;
            align-items: center;
            color: white;
            cursor: pointer;
        }

        .sora-cart-details:after {
            content: '\f290';
            font-family: 'FontAwesome';
            font-size: 24px;
            margin-left: 5px;
        }

        .simpleCart_quantity {
            background: #f08804;
            color: #0f1111;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 20px;
            margin-left: 5px;
        }

        .sora-cart-description {
            position: absolute;
            right: 0;
            top: 40px;
            width: 350px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 20px;
            display: none;
            z-index: 1000;
        }

        .sora-cart:hover .sora-cart-description {
            display: block;
        }

        .header-menu {
            background: #232f3e;
            padding: 0 20px;
        }

        #main-menu ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        #main-menu ul li a {
            color: white;
            font-size: 14px;
            font-weight: 500;
            padding: 8px 0;
            display: block;
        }

        #main-menu ul li a:hover {
            color: #f08804;
        }

        /* ===== BREADCRUMB ===== */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #6c757d;
        }

        .breadcrumb a {
            color: #007185;
        }

        .breadcrumb i {
            font-size: 12px;
            color: #6c757d;
        }

        /* ===== CATEGORÍA HEADER ===== */
        .category-header {
            max-width: 1500px;
            margin: 30px auto 20px;
            padding: 0 20px;
        }

        .category-title {
            font-size: 32px;
            font-weight: 700;
            color: #0f1111;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .category-icon {
            background: #232f3e;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .category-description {
            color: #6c757d;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .category-stats {
            display: flex;
            gap: 20px;
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* ===== FILTROS Y ORDENAMIENTO ===== */
        .category-controls {
            max-width: 1500px;
            margin: 0 auto 30px;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            min-width: 150px;
            background: white;
            cursor: pointer;
        }

        .filter-select:focus {
            border-color: #f08804;
            outline: none;
        }

        .sort-select {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            min-width: 200px;
            background: white;
            cursor: pointer;
        }

        .active-filters {
            max-width: 1500px;
            margin: 0 auto 20px;
            padding: 0 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-tag {
            background: #e9ecef;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-tag i {
            cursor: pointer;
            color: #6c757d;
        }

        .filter-tag i:hover {
            color: #dc3545;
        }

        .clear-filters {
            color: #007185;
            font-size: 13px;
            cursor: pointer;
            background: none;
            border: none;
        }

        /* ===== GRID DE PRODUCTOS ===== */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            max-width: 1500px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .product-image {
            width: 100%;
            height: 250px;
            object-fit: contain;
            margin-bottom: 15px;
        }

        .product-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
            line-height: 1.4;
            height: 44px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-rating {
            color: #ffa41c;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 24px;
            font-weight: 700;
            color: #b12704;
            margin: 10px 0;
        }

        .product-price small {
            font-size: 14px;
            font-weight: 400;
            color: #565959;
            margin-left: 5px;
        }

        .product-original-price {
            font-size: 14px;
            color: #6c757d;
            text-decoration: line-through;
            margin-left: 8px;
        }

        .product-discount {
            display: inline-block;
            background: #dc3545;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .product-stock {
            font-size: 12px;
            color: #007600;
            margin-bottom: 15px;
        }

        .product-stock-low {
            color: #856404;
        }

        .product-agotado {
            background: #dc3545;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            margin: 10px 0;
        }

        .btn-add-cart {
            background: #ffd814;
            border: none;
            border-radius: 20px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            color: #0f1111;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-add-cart:hover {
            background: #f7ca00;
        }

        .btn-add-cart:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* ===== PAGINACIÓN ===== */
        .pagination {
            max-width: 1500px;
            margin: 50px auto;
            padding: 0 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .pagination-item {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination-item:hover {
            border-color: #f08804;
            background: #fff6e5;
        }

        .pagination-item.active {
            background: #f08804;
            color: white;
            border-color: #f08804;
        }

        .pagination-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== NO RESULTS ===== */
        .no-results {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            max-width: 1500px;
            margin: 40px auto;
        }

        .no-results i {
            font-size: 64px;
            color: #dee2e6;
            margin-bottom: 20px;
        }

        .no-results h2 {
            margin-bottom: 10px;
            color: #0f1111;
        }

        .no-results p {
            color: #6c757d;
            margin-bottom: 30px;
        }

        .no-results .btn {
            display: inline-block;
            padding: 12px 30px;
            background: #ffd814;
            border: none;
            border-radius: 20px;
            color: #0f1111;
            font-weight: 600;
            text-decoration: none;
        }

        /* ===== LOADING ===== */
        .loading-container {
            text-align: center;
            padding: 100px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            max-width: 1500px;
            margin: 40px auto;
        }

        .loading-container i {
            font-size: 64px;
            color: #009644;
            margin-bottom: 20px;
        }

        /* ===== FOOTER ===== */
        #footer-wrapper {
            background: #232f3e;
            color: white;
            padding: 50px 20px;
            margin-top: 50px;
        }

        .footer-widgets-wrap {
            max-width: 1500px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 40px;
        }

        .footer a {
            color: #ddd;
        }

        .footer a:hover {
            color: white;
        }

        #sub-footer-wrapper {
            background: #131921;
            padding: 20px;
            text-align: center;
            color: #ddd;
        }

        .back-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #232f3e;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            display: none;
            transition: all 0.3s;
            z-index: 99;
        }

        .back-top:hover {
            background: #f08804;
        }

        @media (max-width: 768px) {
            .category-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .filters {
                flex-direction: column;
            }
            .filter-select, .sort-select {
                width: 100%;
            }
            .category-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div id="outer-wrapper">
        <!-- HEADER -->
        <div id="header-wrap">
            <div class="header-header">
                <div class="container row">
                    <div class="header-logo">
                        <a href="/">
                            <img src="http://imgfz.com/i/oXOfVlT.png" alt="CUBAZON" style="height: 50px;">
                        </a>
                    </div>
                    <div class="header-right">
                        <div class="top-bar-social">
                            <ul>
                                <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                                <li><a href="#"><i class="fa fa-instagram"></i></a></li>
                                <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                            </ul>
                        </div>
                        <div class="right-menu">
                            <ul>
                                <li><a href="/login.html" id="userMenuLink">
                                    <i class="fa fa-sign-in"></i> 
                                    <span id="userMenuText">Iniciar sesión</span>
                                </a></li>
                                <li><a href="#"><i class="fa fa-phone"></i> +53 56940021</a></li>
                                <li><a href="#"><i class="fa fa-envelope"></i> soporte@cubazon.com</a></li>
                            </ul>
                        </div>
                        <div class="sora-cart">
                            <div class="sora-cart-details">
                                <span class="simpleCart_quantity" id="cart-counter">0</span>
                            </div>
                            <div class="sora-cart-description">
                                <div class="simpleCart_items" id="cart-preview">
                                    <p style="padding: 20px; text-align: center; color: #666;">Tu carrito está vacío</p>
                                </div>
                                <div class="sora-cart-buttons-wrap">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                                        <button onclick="window.cart.vaciar()" style="background: none; border: none; color: #0f1111; cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                                            <i class="fa fa-trash"></i> Vaciar todo
                                        </button>
                                        <a href="/p/checkout.html" style="background: #ffd814; padding: 8px 20px; border-radius: 20px; color: #0f1111; font-weight: 600; text-decoration: none;">
                                            <i class="fa fa-lock"></i> Pagar
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="header-menu">
                <div class="container row">
                    <div id="main-menu">
                        <ul>
                            <li><a href="/">Inicio</a></li>
                            <li><a href="/categoria.html?cat=ofertas">Ofertas</a></li>
                            <li><a href="/categoria.html?cat=Electrónica">Electrónica</a></li>
                            <li><a href="/categoria.html?cat=Ropa">Ropa</a></li>
                            <li><a href="/categoria.html?cat=Hogar">Hogar</a></li>
                            <li><a href="/categoria.html?cat=Accesorios">Accesorios</a></li>
                            <li><a href="/p/cart.html">Mi Carrito</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div id="category-content">
            <div id="loadingContainer" class="loading-container">
                <i class="fa fa-spinner fa-pulse"></i>
                <h2>Cargando categoría...</h2>
                <p>Por favor espera</p>
            </div>
            
            <div id="errorContainer" class="no-results" style="display: none;">
                <i class="fa fa-exclamation-triangle"></i>
                <h2>Categoría no encontrada</h2>
                <p>La categoría que buscas no existe.</p>
                <a href="/" class="btn">Volver al inicio</a>
            </div>
            
            <div id="categoryContainer" style="display: none;"></div>
        </div>

        <!-- FOOTER -->
        <div id="footer-wrapper">
            <div class="footer-widgets-wrap">
                <div class="footer">
                    <h3 style="color: white; margin-bottom: 20px;">CUBAZON</h3>
                    <p style="color: #ddd; margin-bottom: 15px;">Tu tienda online de confianza en Sagua de Tánamo.</p>
                    <p style="color: #ddd;"><i class="fa fa-map-marker"></i> Sagua de Tánamo, Holguín, Cuba</p>
                </div>
                <div class="footer">
                    <h3 style="color: white; margin-bottom: 20px;">Enlaces rápidos</h3>
                    <ul style="list-style: none;">
                        <li style="margin-bottom: 10px;"><a href="#">Sobre nosotros</a></li>
                        <li style="margin-bottom: 10px;"><a href="#">Términos y condiciones</a></li>
                        <li style="margin-bottom: 10px;"><a href="#">Política de envíos</a></li>
                        <li style="margin-bottom: 10px;"><a href="#">Contacto</a></li>
                    </ul>
                </div>
                <div class="footer">
                    <h3 style="color: white; margin-bottom: 20px;">Atención al cliente</h3>
                    <p style="color: #ddd; margin-bottom: 10px;"><i class="fa fa-phone"></i> +53 56940021</p>
                    <p style="color: #ddd; margin-bottom: 10px;"><i class="fa fa-envelope"></i> soporte@cubazon.com</p>
                    <p style="color: #ddd;"><i class="fa fa-whatsapp"></i> +53 56940021</p>
                </div>
            </div>
        </div>
        <div id="sub-footer-wrapper">
            <div class="container row">
                <p>@Copyright 2026 CUBAZON · Diseñado por Des.Joshua_Technology · Todos los derechos reservados</p>
            </div>
        </div>

        <div class="back-top" title="Volver arriba">
            <i class="fa fa-chevron-up"></i>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script type="module">
        import { supabase } from '/js/supabase-client.js'
        import { initCarrito } from '/js/cart.js'
        import { auth } from '/js/auth.js'
        
        const carrito = initCarrito()
        window.cart = carrito
        carrito.cargarDeLocalStorage()
        carrito.actualizarInterfaz()

        // ========== CONFIGURACIÓN DE CATEGORÍAS ==========
        const CATEGORIAS = {
            'Electrónica': { icon: 'fa-laptop', desc: 'Encuentra los mejores dispositivos electrónicos, computadoras, tablets y accesorios.' },
            'Ropa': { icon: 'fa-tshirt', desc: 'Moda para hombre, mujer y niños. Ropa casual, formal y deportiva.' },
            'Hogar': { icon: 'fa-home', desc: 'Todo para tu hogar: muebles, decoración, cocina y más.' },
            'Deportes': { icon: 'fa-soccer-ball-o', desc: 'Equipamiento deportivo, ropa y accesorios para mantenerte activo.' },
            'Accesorios': { icon: 'fa-battery-full', desc: 'Complementos, cargadores, fundas y más para tus dispositivos.' },
            'Consumibles': { icon: 'fa-print', desc: 'Insumos para oficina, tóner, papel y artículos de papelería.' },
            'Limpieza': { icon: 'fa-filter', desc: 'Productos de limpieza para el hogar y la oficina.' },
            'Útiles': { icon: 'fa-book', desc: 'Artículos escolares y de oficina. Todo lo que necesitas para estudiar.' },
            'ofertas': { icon: 'fa-fire', desc: 'Los mejores descuentos y promociones especiales.' },
            'Ofertas': { icon: 'fa-fire', desc: 'Los mejores descuentos y promociones especiales.' }
        }

        // ========== ESTADO GLOBAL ==========
        let productosOriginales = []
        let productosFiltrados = []
        let categoriaActual = ''
        let filtrosActivos = {
            precioMin: 0,
            precioMax: 1000,
            soloOfertas: false,
            soloStock: false,
            orden: 'relevancia'
        }
        let paginaActual = 1
        const PRODUCTOS_POR_PAGINA = 12

        // ========== ACTUALIZAR MENÚ DE USUARIO ==========
        function actualizarMenuUsuario() {
            const userMenuLink = document.getElementById('userMenuLink')
            const userMenuText = document.getElementById('userMenuText')
            
            if (!userMenuLink || !userMenuText) return
            
            if (auth.isAuthenticated()) {
                const usuario = auth.getUsuario()
                const nombre = usuario?.nombre || 'Mi cuenta'
                userMenuText.textContent = nombre
                userMenuLink.href = '/mi-cuenta.html'
                userMenuLink.innerHTML = `<i class="fa fa-user"></i> ${nombre}`
            } else {
                userMenuText.textContent = 'Iniciar sesión'
                userMenuLink.href = '/login.html'
                userMenuLink.innerHTML = '<i class="fa fa-sign-in"></i> Iniciar sesión'
            }
        }

        // ========== OBTENER CATEGORÍA DE LA URL ==========
        function getCategoriaFromUrl() {
            const urlParams = new URLSearchParams(window.location.search)
            return urlParams.get('cat') || urlParams.get('categoria') || ''
        }

        // ========== CARGAR PRODUCTOS POR CATEGORÍA ==========
        async function cargarCategoria() {
            const cat = getCategoriaFromUrl()
            
            if (!cat) {
                document.getElementById('loadingContainer').style.display = 'none'
                document.getElementById('errorContainer').style.display = 'block'
                return
            }

            categoriaActual = cat
            
            try {
                document.getElementById('loadingContainer').style.display = 'block'
                document.getElementById('categoryContainer').style.display = 'none'
                
                // Obtener TODOS los productos
                const { data, error } = await supabase
                    .from('productos')
                    .select('*')
                
                if (error) throw error
                
                // Filtrar por categoría (usando etiquetas)
                let productosFiltradosPorCat = []
                
                if (cat.toLowerCase() === 'ofertas') {
                    productosFiltradosPorCat = data.filter(p => p.oferta === true)
                } else {
                    // Buscar en el array de etiquetas
                    productosFiltradosPorCat = data.filter(p => 
                        p.etiquetas && p.etiquetas.some(et => 
                            et.toLowerCase() === cat.toLowerCase()
                        )
                    )
                }
                
                productosOriginales = productosFiltradosPorCat || []
                aplicarFiltrosYOrden()
                
                document.getElementById('loadingContainer').style.display = 'none'
                document.getElementById('categoryContainer').style.display = 'block'
                
            } catch (error) {
                console.error('Error cargando categoría:', error)
                document.getElementById('loadingContainer').style.display = 'none'
                document.getElementById('errorContainer').style.display = 'block'
            }
        }

        // ========== APLICAR FILTROS Y ORDEN ==========
        function aplicarFiltrosYOrden() {
            let productos = [...productosOriginales]
            
            // Filtro por precio
            productos = productos.filter(p => 
                p.precio >= filtrosActivos.precioMin && 
                p.precio <= filtrosActivos.precioMax
            )
            
            // Filtro solo ofertas
            if (filtrosActivos.soloOfertas) {
                productos = productos.filter(p => p.oferta === true)
            }
            
            // Filtro solo productos en stock
            if (filtrosActivos.soloStock) {
                productos = productos.filter(p => p.stock > 0)
            }
            
            // Ordenamiento
            switch(filtrosActivos.orden) {
                case 'menor-precio':
                    productos.sort((a, b) => a.precio - b.precio)
                    break
                case 'mayor-precio':
                    productos.sort((a, b) => b.precio - a.precio)
                    break
                case 'nombre':
                    productos.sort((a, b) => a.nombre.localeCompare(b.nombre))
                    break
                case 'descuento':
                    productos.sort((a, b) => (b.oferta ? 1 : 0) - (a.oferta ? 1 : 0))
                    break
                default:
                    productos.sort((a, b) => (b.destacado ? 1 : 0) - (a.destacado ? 1 : 0))
            }
            
            productosFiltrados = productos
            paginaActual = 1
            renderizarCategoria()
            renderizarFiltrosActivos()
        }

        // ========== RENDERIZAR CATEGORÍA ==========
        function renderizarCategoria() {
            const container = document.getElementById('categoryContainer')
            const infoCategoria = CATEGORIAS[categoriaActual] || {
                icon: 'fa-tag',
                desc: `Explora todos los productos en ${categoriaActual}`
            }
            
            const start = (paginaActual - 1) * PRODUCTOS_POR_PAGINA
            const end = start + PRODUCTOS_POR_PAGINA
            const productosPagina = productosFiltrados.slice(start, end)
            const totalPaginas = Math.ceil(productosFiltrados.length / PRODUCTOS_POR_PAGINA)
            
            const breadcrumb = `
                <div class="breadcrumb">
                    <a href="/">Inicio</a>
                    <i class="fa fa-chevron-right"></i>
                    <span style="color: #0f1111;">${categoriaActual}</span>
                </div>
            `
            
            let headerHtml = `
                ${breadcrumb}
                <div class="category-header">
                    <div class="category-title">
                        <span class="category-icon">
                            <i class="fa ${infoCategoria.icon}"></i>
                        </span>
                        ${categoriaActual}
                    </div>
                    <div class="category-description">${infoCategoria.desc}</div>
                    <div class="category-stats">
                        <span><i class="fa fa-cube"></i> ${productosFiltrados.length} productos</span>
                        ${categoriaActual.toLowerCase() === 'ofertas' 
                            ? `<span><i class="fa fa-fire"></i> Descuentos especiales</span>` 
                            : ''}
                    </div>
                </div>
            `
            
            let controlesHtml = `
                <div class="category-controls">
                    <div class="filters">
                        <select id="filtroOfertas" class="filter-select">
                            <option value="todos">Todos los productos</option>
                            <option value="ofertas" ${filtrosActivos.soloOfertas ? 'selected' : ''}>Solo ofertas</option>
                            <option value="stock" ${filtrosActivos.soloStock ? 'selected' : ''}>Solo en stock</option>
                        </select>
                        
                        <select id="filtroPrecio" class="filter-select">
                            <option value="0-1000">Todos los precios</option>
                            <option value="0-25">Menos de $25</option>
                            <option value="25-50">$25 - $50</option>
                            <option value="50-100">$50 - $100</option>
                            <option value="100-1000">Más de $100</option>
                        </select>
                    </div>
                    
                    <select id="ordenProductos" class="sort-select">
                        <option value="relevancia" ${filtrosActivos.orden === 'relevancia' ? 'selected' : ''}>Ordenar por: Relevancia</option>
                        <option value="menor-precio" ${filtrosActivos.orden === 'menor-precio' ? 'selected' : ''}>Menor precio</option>
                        <option value="mayor-precio" ${filtrosActivos.orden === 'mayor-precio' ? 'selected' : ''}>Mayor precio</option>
                        <option value="nombre" ${filtrosActivos.orden === 'nombre' ? 'selected' : ''}>Nombre</option>
                        <option value="descuento" ${filtrosActivos.orden === 'descuento' ? 'selected' : ''}>Mayor descuento</option>
                    </select>
                </div>
            `
            
            let filtrosActivosHtml = `<div id="activeFilters" class="active-filters"></div>`
            
            let productosHtml = ''
            
            if (productosPagina.length === 0) {
                productosHtml = `
                    <div class="no-results">
                        <i class="fa fa-search"></i>
                        <h2>No hay productos</h2>
                        <p>No encontramos productos en esta categoría con los filtros seleccionados.</p>
                        <button onclick="window.limpiarFiltros()" class="btn">
                            Limpiar filtros
                        </button>
                    </div>
                `
            } else {
                productosHtml = `<div class="products-grid">`
                
                productosPagina.forEach(p => {
                    const precioOferta = p.oferta && p.precio_oferta ? p.precio_oferta : null
                    const precioActual = precioOferta || p.precio
                    const descuento = p.oferta && p.precio_oferta 
                        ? Math.round(((p.precio - p.precio_oferta) / p.precio) * 100) 
                        : 0
                    
                    let stockClass = ''
                    let stockText = ''
                    
                    if (p.stock <= 0) {
                        stockClass = 'product-agotado'
                        stockText = 'AGOTADO'
                    } else if (p.stock <= 5) {
                        stockClass = 'product-stock-low'
                        stockText = `¡Últimos ${p.stock}!`
                    } else {
                        stockText = `${p.stock} disponibles`
                    }
                    
                    productosHtml += `
                        <div class="product-card">
                            <a href="/producto.html?id=${p.id}">
                                <img src="${p.imagen_url || '/assets/images/no-image.jpg'}" 
                                     class="product-image" 
                                     alt="${p.nombre}"
                                     onerror="this.src='/assets/images/no-image.jpg'">
                                <h3 class="product-title">${p.nombre}</h3>
                            </a>
                            <div class="product-rating">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star-half-o"></i>
                            </div>
                            <div class="product-price">
                                $${precioActual.toFixed(2)} <small>CUP</small>
                                ${precioOferta ? `<span class="product-original-price">$${p.precio.toFixed(2)}</span>` : ''}
                                ${descuento > 0 ? `<span class="product-discount">-${descuento}%</span>` : ''}
                            </div>
                            ${p.stock > 0 ? `
                                <div class="product-stock ${stockClass}">
                                    <i class="fa ${p.stock <= 5 ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                                    ${stockText}
                                </div>
                            ` : ''}
                            ${p.stock > 0 ? `
                                <button class="btn-add-cart" onclick="window.cart.agregar('${p.id}', 1, {})">
                                    <i class="fa fa-shopping-cart"></i> Agregar
                                </button>
                            ` : `
                                <div class="product-agotado">
                                    <i class="fa fa-ban"></i> AGOTADO
                                </div>
                            `}
                        </div>
                    `
                })
                
                productosHtml += `</div>`
            }
            
            let paginacionHtml = ''
            if (totalPaginas > 1) {
                paginacionHtml = `<div class="pagination">`
                
                paginacionHtml += `
                    <div class="pagination-item ${paginaActual === 1 ? 'disabled' : ''}" 
                         onclick="${paginaActual > 1 ? 'window.cambiarPagina(' + (paginaActual - 1) + ')' : ''}">
                        <i class="fa fa-chevron-left"></i>
                    </div>
                `
                
                for (let i = 1; i <= totalPaginas; i++) {
                    if (i === 1 || i === totalPaginas || (i >= paginaActual - 2 && i <= paginaActual + 2)) {
                        paginacionHtml += `
                            <div class="pagination-item ${i === paginaActual ? 'active' : ''}" 
                                 onclick="window.cambiarPagina(${i})">
                                ${i}
                            </div>
                        `
                    } else if (i === paginaActual - 3 || i === paginaActual + 3) {
                        paginacionHtml += `<div class="pagination-item disabled">...</div>`
                    }
                }
                
                paginacionHtml += `
                    <div class="pagination-item ${paginaActual === totalPaginas ? 'disabled' : ''}" 
                         onclick="${paginaActual < totalPaginas ? 'window.cambiarPagina(' + (paginaActual + 1) + ')' : ''}">
                        <i class="fa fa-chevron-right"></i>
                    </div>
                `
                
                paginacionHtml += `</div>`
            }
            
            container.innerHTML = `
                ${headerHtml}
                ${controlesHtml}
                ${filtrosActivosHtml}
                ${productosHtml}
                ${paginacionHtml}
            `
            
            renderizarFiltrosActivos()
            agregarEventListeners()
        }

        // ========== RENDERIZAR FILTROS ACTIVOS ==========
        function renderizarFiltrosActivos() {
            const container = document.getElementById('activeFilters')
            if (!container) return
            
            let html = ''
            
            if (filtrosActivos.soloOfertas) {
                html += `<span class="filter-tag">
                    Solo ofertas <i class="fa fa-times" onclick="window.toggleFiltroOfertas()"></i>
                </span>`
            }
            
            if (filtrosActivos.soloStock) {
                html += `<span class="filter-tag">
                    Solo en stock <i class="fa fa-times" onclick="window.toggleFiltroStock()"></i>
                </span>`
            }
            
            if (filtrosActivos.precioMin > 0 || filtrosActivos.precioMax < 1000) {
                html += `<span class="filter-tag">
                    Precio: $${filtrosActivos.precioMin} - $${filtrosActivos.precioMax}
                    <i class="fa fa-times" onclick="window.limpiarFiltroPrecio()"></i>
                </span>`
            }
            
            if (html) {
                html += `<button class="clear-filters" onclick="window.limpiarFiltros()">
                    Limpiar todo
                </button>`
            }
            
            container.innerHTML = html
        }

        // ========== EVENT LISTENERS ==========
        function agregarEventListeners() {
            document.getElementById('filtroOfertas')?.addEventListener('change', function(e) {
                const valor = e.target.value
                filtrosActivos.soloOfertas = valor === 'ofertas'
                filtrosActivos.soloStock = valor === 'stock'
                aplicarFiltrosYOrden()
            })
            
            document.getElementById('filtroPrecio')?.addEventListener('change', function(e) {
                const [min, max] = e.target.value.split('-').map(Number)
                filtrosActivos.precioMin = min
                filtrosActivos.precioMax = max
                aplicarFiltrosYOrden()
            })
            
            document.getElementById('ordenProductos')?.addEventListener('change', function(e) {
                filtrosActivos.orden = e.target.value
                aplicarFiltrosYOrden()
            })
        }

        // ========== FUNCIONES GLOBALES ==========
        window.cambiarPagina = function(pagina) {
            paginaActual = pagina
            renderizarCategoria()
            window.scrollTo({ top: 0, behavior: 'smooth' })
        }

        window.toggleFiltroOfertas = function() {
            filtrosActivos.soloOfertas = false
            aplicarFiltrosYOrden()
        }

        window.toggleFiltroStock = function() {
            filtrosActivos.soloStock = false
            aplicarFiltrosYOrden()
        }

        window.limpiarFiltroPrecio = function() {
            filtrosActivos.precioMin = 0
            filtrosActivos.precioMax = 1000
            aplicarFiltrosYOrden()
        }

        window.limpiarFiltros = function() {
            filtrosActivos = {
                precioMin: 0,
                precioMax: 1000,
                soloOfertas: false,
                soloStock: false,
                orden: 'relevancia'
            }
            aplicarFiltrosYOrden()
        }

        // ========== INICIALIZAR ==========
        setTimeout(actualizarMenuUsuario, 500)
        auth.onCambio(actualizarMenuUsuario)
        cargarCategoria()

        // Back to top
        window.addEventListener('scroll', function() {
            const backTop = document.querySelector('.back-top')
            if (window.scrollY > 300) {
                backTop.style.display = 'flex'
            } else {
                backTop.style.display = 'none'
            }
        })
        
        document.querySelector('.back-top')?.addEventListener('click', function() {
            window.scrollTo({ top: 0, behavior: 'smooth' })
        })
    </script>
</body>
</html>